Reproducible Research, Peer Assessment 2
========================================

## Questions

1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
2. Across the United States, which types of events have the greatest economic consequences?

## Data

```{r download}
require(data.table)
setInternet2(TRUE)
if(!file.exists('StormData.RData')) {
    here <- tempdir()
    data <- paste(here,'StormData.csv.bz2',sep='/')
    download.file('https://d396qusza40orc.cloudfront.net/repdata/data/StormData.csv.bz2',data)
    data <- data.table(read.csv(data, stringsAsFactors=FALSE))
    save(data,file='StormData.RData')
} else {
    load('StormData.RData')
}
```

## Ranking of event types by injuries and fatalities

```{r peoplesum}
myn <- 10 # Top myn causes of injuries, fatalities. Set to suit.
peoplesum <- data[,list(fatalities=sum(FATALITIES), 
                        injuries=sum(INJURIES)),
                  by=list(EVTYPE)]
data$BGN_DATE <- as.Date(sapply(data$BGN_DATE,
                                function(x) {unlist(strsplit(x," "))[1]}),"%m/%d/%Y")
```

There are `r formatC(length(unique(peoplesum$EVTYPE)),big.mark=",")` event types in the StormData data set, tracked over `r max(year(data$BGN_DATE))-min(year(data$BGN_DATE))` years, between `r min(year(data$BGN_DATE))` and `r max(year(data$BGN_DATE))`. They were responsible for `r prettyNum(sum(peoplesum$fatalities),big.mark=",")` fatalities and `r prettyNum(sum(peoplesum$injuries),big.mark=",")` injuries.

1. Top `r myn` types of weather events that kill most people:
    ```{r fatalities}
    ftop <- head(peoplesum[order(-fatalities),],n=myn)
    ftop
    ```
    
2. Top `r myn` types of weather events that injure most people:
    ```{r injuries}
    itop <- head(peoplesum[order(-injuries),],n=myn)
    itop
    ```

3. Overlap between the two: 
    ```{r peopledamage}
    fsum <- as.character(ftop[,EVTYPE])
    psum <- as.character(itop[,EVTYPE])
    olap <- sort(intersect(fsum,psum))
    ftopnum <- sum(ftop[,injuries][ftop[,EVTYPE] %in% olap])
    itopnum <- sum(itop[,fatalities][itop[,EVTYPE] %in% olap])
    ftopshare <- ftopnum/sum(ftop[,injuries])
    itopshare <- itopnum/sum(itop[,fatalities])
    fallshare <- ftopnum/sum(peoplesum[,injuries])
    iallshare <- itopnum/sum(peoplesum[,fatalities])
    t(t(olap))
    ```

The `r length(olap)` types of events that show up in both top `r myn` lists, shown above, are responsible for `r round(100*ftopshare,0)`% of fatalities and `r round(100*itopshare,0)`% of injuries in each top `r myn` list. This amounts to `r round(100*iallshare,0)`% of all recorded injuries and `r round(100*fallshare,0)`% of all recorded fatalities in the StormData file.


